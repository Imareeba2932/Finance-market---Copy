{% extends 'base.html' %}
{% block content %}
<div class="row g-4">
  <div class="col-12 d-flex align-items-baseline justify-content-between">
    <div>
      <h1 class="page-title">Global Finance Dashboard</h1>
      <p class="text-muted mb-0">Interactive analytics powered by Plotly</p>
    </div>
  </div>

  <div class="col-lg-3">
    <form class="card card-filter p-3 sticky-sidebar" method="get">
      <div class="d-flex align-items-center justify-content-between mb-2">
        <h6 class="mb-0">Filters</h6>
        <a href="{{ url_for('home') }}" class="btn btn-link btn-sm p-0">Reset</a>
      </div>
      <div class="mb-3">
        <label class="form-label">Countries</label>
        <select class="form-select" name="country" multiple size="8">
          {% for c in meta.countries %}
            <option value="{{ c }}" {% if c in selected.countries %}selected{% endif %}>{{ c }}</option>
          {% endfor %}
        </select>
        <div class="form-text">Ctrl/Cmd + click to multi-select</div>
      </div>
      <div class="mb-3">
        <label class="form-label">Credit Ratings</label>
        <select class="form-select" name="rating" multiple size="6">
          {% for r in meta.credit_ratings %}
            <option value="{{ r }}" {% if r in selected.ratings %}selected{% endif %}>{{ r }}</option>
          {% endfor %}
        </select>
      </div>
      <div class="row g-2 mb-3">
        <div class="col-6">
          <label class="form-label">Start Date</label>
          <input class="form-control" type="date" name="start_date" value="{{ selected.start_date or '' }}" />
        </div>
        <div class="col-6">
          <label class="form-label">End Date</label>
          <input class="form-control" type="date" name="end_date" value="{{ selected.end_date or '' }}" />
        </div>
      </div>
      <button class="btn btn-primary w-100">Apply Filters</button>

      <hr class="my-3" />
      <div>
        <div class="small text-muted mb-1">Selected</div>
        <div class="d-flex flex-wrap gap-1">
          {% for c in selected.countries %}
            <span class="filter-chip">{{ c }}</span>
          {% endfor %}
          {% for r in selected.ratings %}
            <span class="filter-chip chip-muted">{{ r }}</span>
          {% endfor %}
          {% if selected.start_date or selected.end_date %}
            <span class="filter-chip chip-date">{{ selected.start_date or '—' }} → {{ selected.end_date or '—' }}</span>
          {% endif %}
        </div>
      </div>
    </form>
  </div>

  <div class="col-lg-9">
    {% if kpis %}
    <div class="row g-3">
      {% for label, value in kpis.items() %}
      <div class="col-sm-6 col-xl-3">
        <div class="card kpi">
          <div class="card-body">
            <div class="kpi-label">{{ label }}</div>
            <div class="kpi-value">{{ value }}</div>
          </div>
        </div>
      </div>
      {% endfor %}
    </div>
    {% endif %}

  <div class="row g-3 mt-1">
  <div class="col-xl-8">
    <div class="card">
      <div class="card-header">Market Cap by Country (T$)</div>
      <div class="card-body">
        {{ market_cap_div|safe if market_cap_div else '<div class="text-muted">No data</div>' }}
        <div class="mt-3 chart-footer insight">
          <p><strong>Insight:</strong> Larger bars show countries with higher total market capitalization.</p>
          <p><strong>Conclusion:</strong> A bigger market is not always a better investment; compare fundamentals.</p>
        </div>
      </div>
    </div>
  </div>
  <div class="col-xl-4">
    <div class="card">
      <div class="card-header">Dataset Snapshot</div>
      <div class="card-body table-responsive">{{ table|safe }}</div>
    </div>
  </div>

  <div class="col-xl-6">
    <div class="card">
      <div class="card-header">Index vs Daily Change</div>
      <div class="card-body">
        {{ rel_scatter1_div|safe if rel_scatter1_div else '<div class="text-muted">No data</div>' }}
        <div class="mt-3 chart-footer insight">
          <p><strong>Insight:</strong> High index levels do not guarantee big daily moves.</p>
          <p><strong>Conclusion:</strong> For short-term moves, check recent changes rather than index size.</p>
        </div>
      </div>
    </div>
  </div>
  <div class="col-xl-6">
    <div class="card">
      <div class="card-header">Policy Rate vs 10Y Yield</div>
      <div class="card-body">
        {{ rel_scatter2_div|safe if rel_scatter2_div else '<div class="text-muted">No data</div>' }}
        <div class="mt-3 chart-footer insight">
          <p><strong>Insight:</strong> Higher policy rates often come with higher long‑term yields, but not one‑for‑one.</p>
          <p><strong>Conclusion:</strong> Use both short and long rates to gauge the interest rate environment.</p>
        </div>
      </div>
    </div>
  </div>
  </div>
  </div>
</div>
{% endblock %}


